# storagespace

#### Facebook CTF 2019

### Условия задания
Дана система безопасного хранения флагов. Требуется получить флаг. Система принимает команды в формате JSON. Например: `help (command = "flag")` отобразит справочную информацию для команды flag, и запрос будет выглядеть так: 

`{"command": "help", "params": {"command": "flag"}}`

`flag(name: Optional[str])`

`Retrieve flag by name.`

`{"command": "flag", "params": {"name": "myflag"}}`

`flag{this_is_not_a_real_flag}`

Некоторые команды требуют подписанного запроса. Для этого есть команда sign, но она не может подписать команду flag. 

### Уязвимость

Чтобы получить флаг, необходимо:
1. Выполнить `sign(command="spec")`: получить `spec` алгоритма подписи по команде
2. Выполнить `sign(command="list")`: получить имя файла флага `file_name` по команде
3. Выполнить `sign(command="info")`: Получить параметры кривой ECC: `a`, `b`, `p`, генератор `G`, открытый ключ `H`
4. Получить секретный ключ `key`, который удовлетворяет уравнению `key * G == H`
5. Сгенерировать сообщение`flag(name=file_name)`.
6. Подписать сообщение, полученное на шаге 5, и получить пару значений `(r, s)`, используя ключ `key` и алгоритм подписи, полученный на шаге 1.
7. Обновить подписанное сообщение парой значений `(r, s)` и выполнить его.

Сервер использует эллиптическую кривую для подписи сообщений.

Порядок эллиптической кривой, используемой сорвером, достаточно мал, чтобы 
решить [задачу дискретного логарифмирования в группе точек эллиптической кривой (ECDLP)](novotney.pdf). 
Если она разрешима для данного значения, у неё должно быть хотя бы одно натуральное решение, 
не превышающее порядок группы. Поэтому можно сразу получить грубую оценку сверху сложности алгоритма поиска решений 
— алгоритм полного перебора нашел бы решение за число шагов не выше порядка данной группы.

ECDLP можно решить [алгоритмом Полига — Хеллмана](Sommerseth+Hoeiland.pdf)


Решает ECDLP: [ECDLP.sage](ECDLP.sage)

Получает флаг: [solve.py](solve.py) 
